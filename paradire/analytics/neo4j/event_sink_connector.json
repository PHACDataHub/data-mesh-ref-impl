{
    "name": "event_sink_connector",
    "config": {
        "_comment": "Sink configuration for EHR events",
        "connector.class": "streams.kafka.connect.sink.Neo4jSinkConnector",
        "key.converter": "io.confluent.connect.avro.AvroConverter",
        "key.converter.schema.registry.url": "http://schema-registry:8081",
        "value.converter": "io.confluent.connect.avro.AvroConverter",
        "value.converter.schema.registry.url": "http://schema-registry:8081",
        "errors.retry.timeout": "-1",
        "errors.retry.delay.max.ms": "1000",
        "errors.tolerance": "all",
        "errors.log.enable": true,
        "errors.log.include.messages": true,
        "neo4j.server.uri": "bolt://neo4j:7687",
        "neo4j.authentication.basic.username": "neo4j",
        "neo4j.authentication.basic.password": "phac@2023",
        "neo4j.encryption.enabled": false,
        "topics": "allergies",
        "neo4j.topic.cypher.allergies": "CREATE (n:Allergy) SET n.start = DATE(event.start), n.stop = DATE(event.stop), n.code = event.code, n.system = event.system, n.description = event.description, n.allergy_type = event.allergy_type, n.category = event.category, n.reaction_1 = event.reaction_1, n.description_1 = event.description_1, n.severity_1 = event.severity_1, n.reaction_2 = event.reaction_2, n.description_2 = event.description_2, n.severity_2 = event.severity_2 WITH n, event MERGE (p:Patient {patient_id: event.patient_id}), (e:Encounter {encounter_id: event.encounter_id}) WITH n, p, e MERGE (n)-[:ALLERGY_OF_PATIENT]->(p) MERGE (n)-[:ALLERGY_OF_ENCOUNTER]->(e)"
    }
}

